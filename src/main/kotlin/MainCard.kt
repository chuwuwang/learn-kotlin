import com.big.river.card.APDUCardHelper
import com.big.river.card.APDUTransactionHelper
import com.big.river.card.TransactionAssist
import com.big.river.card.TransactionInfo
import com.big.river.helper.ByteHelper
import com.big.river.tlv.TLVHelper
import java.nio.charset.Charset
import java.util.*

val charset: Charset = Charset.forName("US-ASCII")

fun main(args: Array<String>) {

    transactionInfo()

}

private fun analysisAPDU() {
    var apdu =
        "6F30840E325041592E5359532E4444463031A51EBF0C1B61194F08A000000333010101500A50424F432044454249548701019000"
    APDUCardHelper.getCardInfo(apdu)

    apdu =
        "6F568407A0000000031010A54B500A566973612044656269748701019F38189F66049F02069F03069F1A0295055F2A029A039C019F37045F2D02656E9F120A566973612044656269749F110101BF0C089F5A0560078407849000"
    var tagList = APDUTransactionHelper.getTransactionTagList(apdu) ?: emptyList()
    apdu =
        "80A8000023832126800080000000000200000000000000045800000000000458250503008288892900"
    APDUTransactionHelper.builderTransactionTagMap(apdu, tagList)

    apdu =
        "6F368408A000000333010101A52A500A50424F432044454249548701019F38189F66049F02069F03069F1A0295055F2A029A039C019F37049000"
    tagList = APDUTransactionHelper.getTransactionTagList(apdu) ?: emptyList()
    apdu =
        "80A8000023832126800080000000000150000000000000045800000000000458250504009747A22D00"
    APDUTransactionHelper.builderTransactionTagMap(apdu, tagList)

    apdu =
        "7081875F25032208085F24032708315A0851755483214561685F3401019F0702FFC08C279F02069F03069F1A0295055F2A029A039C019F37049F35019F45029F4C089F34039F21039F7C148D0C910A8A0295059F37049F4C088E0E000000000000000042031E031F039F0D05B4508400009F0E0500000000009F0F05B4708480005F280207849F4A01829000"
    tagList = APDUTransactionHelper.getTransactionTagList(apdu) ?: emptyList()
    apdu =
        "80AE90004200000000050000000000000004580000008001045825050300A6A2465822000000000000000000001F0302235036000000000000000000000000000000000000000000"
    APDUTransactionHelper.builderTransactionTagMap(apdu, tagList)

    apdu =
        "7081B89F4701039F4681B04D818289BED030067B40AAC81D5097182B2EC43D77F1F52A2DF8FE430CBC5F20A5F559935C30EE79609B4B4B1D04790FAF6D1AA3B80B70659DE716848E0FB5D9936967CDB5FC5EC9453059D03BA6A7D65680B4C27EEDA59346D3B1BACCC016C3A864985E2DF4412AF208B22EF3C75B0142C5F3914367D8E5B547A81870DB9B2AEBF8122E56120639210328BE298DFAE558392F37338C470B4D20DE3FD2BA2199EEFF06681CB22172D88355C95C2E59FE9000"
    tagList = APDUTransactionHelper.getTransactionTagList(apdu) ?: emptyList()
    apdu =
        "80AE90004200000000050000000000000004580000008001045825050300A6A2465822000000000000000000001F0302235036000000000000000000000000000000000000000000"
    APDUTransactionHelper.builderTransactionTagMap(apdu, tagList)

}

private fun transactionInfo(){
    val info = TransactionInfo()
    info.amount = 10000
    info.cardNumber = "2123131"
    info.currencyCode = "0156"
    info.transactionDate = "250511"
    TransactionAssist.onCallbackTransactionInfo(info)
}

private fun parserIccData() {
    val data =
        "ggJ8AIQIoAAAAzMBAQGVBQAAAAAAmgMkASOcAQBfKgIHhF80AQCfAgYAAAAAAAGfAwYAAAAAAACfCQIAMJ8QFgcBAQOgAAABDaE5mQFnICQBIxUpGICfGgIHhJ8eCDAwMDAwOTA1nyYIT2uNQBl751OfJwGAnzMD4PjInzUBIp82AgABnzcEAKopug=="
    val bytes = Base64.getDecoder().decode(data)
    val hexString = ByteHelper.bytes2HexString(bytes)
    println(hexString)
    TLVHelper.builderMap(hexString)
}

private fun parserBase64Data(data: String) {
    val bytes = Base64.getDecoder().decode(data)
    val string = String(bytes)
    println(string)
    val hexString = ByteHelper.bytes2HexString(bytes)
    println(hexString)
}